- if @style == 'source'
  %ac:structured-macro{"ac:name" => "code"}
    - if confluence_supported_lang(source_lang)
      %ac:parameter{"ac:name" => "language"}= source_lang
    - if title?
      %ac:parameter{"ac:name" => "title"}= title
    - if attr? :linenums
      %ac:parameter{"ac:name" => "linenumbers"} true
    - if attr? :start
      %ac:parameter{"ac:name" => "firstline"}= attr :start
    - wrap_code = (@document.attr? :prewrap) || (has_option?(:nowrap) && !(option? :nowrap))
    %ac:parameter{"ac:name" => "collapse"}= wrap_code
    %ac:plain-text-body= "<![CDATA[#{content}]]>"
- else
  %ac:structured-macro{"ac:name" => "noformat"}
    - if title?
      %ac:parameter{"ac:name" => "title"}= title
    %ac:plain-text-body= "<![CDATA[#{raw_content}]]>"
